---
export interface Props {
  steamId?: string;
}

const { steamId = 'STEAM_0:0:35510357' } = Astro.props;
---

<div class="bg-cs2-gray rounded-lg p-6 shadow-lg">
  <div id="stats-container" class="space-y-6">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-cs2-orange mx-auto"></div>
      <p class="mt-4 text-gray-400">Loading player stats...</p>
    </div>
  </div>
</div>

<script define:vars={{ steamId }}>
  async function loadStats() {
    const container = document.getElementById('stats-container');
    
    try {
      const response = await fetch(`/api/stats/${steamId}`);
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || 'Failed to load stats');
      }
      
      const { player, stats } = data;
      
      container.innerHTML = `
        <div class="flex items-center space-x-4 mb-6">
          <img src="${player.avatar}" alt="${player.personaname}" class="w-16 h-16 rounded-full">
          <div>
            <h2 class="text-2xl font-bold text-white">${player.personaname}</h2>
            <p class="text-gray-400">Steam ID: ${steamId}</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-cs2-orange">${stats.totalKills.toLocaleString()}</div>
            <div class="text-sm text-gray-400">Total Kills</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-red-400">${stats.totalDeaths.toLocaleString()}</div>
            <div class="text-sm text-gray-400">Total Deaths</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-green-400">${stats.kdr}</div>
            <div class="text-sm text-gray-400">K/D Ratio</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-blue-400">${stats.headshotPercentage}%</div>
            <div class="text-sm text-gray-400">Headshot %</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-purple-400">${stats.accuracy}%</div>
            <div class="text-sm text-gray-400">Accuracy</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-yellow-400">${stats.totalWins.toLocaleString()}</div>
            <div class="text-sm text-gray-400">Total Wins</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-indigo-400">${stats.totalRounds.toLocaleString()}</div>
            <div class="text-sm text-gray-400">Total Rounds</div>
          </div>
          
          <div class="bg-cs2-dark p-4 rounded-lg text-center">
            <div class="text-2xl font-bold text-pink-400">${stats.totalTimePlayed.toLocaleString()}h</div>
            <div class="text-sm text-gray-400">Hours Played</div>
          </div>
        </div>
        
        <div class="mt-6 text-xs text-gray-500 text-center">
          Last updated: ${new Date().toLocaleString()}
        </div>
      `;
      
    } catch (error) {
      container.innerHTML = `
        <div class="text-center text-red-400">
          <p class="text-lg font-semibold">Error loading stats</p>
          <p class="text-sm mt-2">${error.message}</p>
          <button onclick="loadStats()" class="mt-4 bg-cs2-orange text-white px-4 py-2 rounded hover:bg-orange-600 transition-colors">
            Retry
          </button>
        </div>
      `;
    }
  }
  
  // Load stats when page loads
  loadStats();
</script>